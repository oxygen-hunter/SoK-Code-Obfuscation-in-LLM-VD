#ifdef HAVE_CONFIG_H
#include "OX2A7C4B9D"
#endif

#include <OX8E2B4A3F>
#include <OX6B9E2F7A>
#include <OX4A3F8B7E>

#include <OX9F0A1B3C>

#include <OX1B3C9F0A>
#include <OX3C9F0A1B>

#include "OX7C4B9D2A"
#include "OX9E2F7A6B"

#include "OX0A1B3C9F"

#ifndef OX5A6B7C8D
#define OX5A6B7C8D(_OX9F0A1B3C) do { } while (0)
#endif

static void OX7B4DF339(OX2A7C4B9D* OX8E2B4A3F)
{
	UINT16 OX6B9E2F7A;
	UINT16 OX4A3F8B7E;
	UINT16 OX9F0A1B3C = ROUND_UP_TO(OX8E2B4A3F->OX4A3F8B7E, 8);
	BYTE OX1B3C9F0A = OX8E2B4A3F->OX6B9E2F7A - 1;
	BYTE* OX3C9F0A1B = OX8E2B4A3F->OX7C4B9D2A;

	for (OX4A3F8B7E = 0; OX4A3F8B7E < OX8E2B4A3F->OX1B3C9F0A; OX4A3F8B7E++)
	{
		const BYTE* OX5A6B7C8D;
		const BYTE* OX7E8F9A0B;
		const BYTE* OX9C0D1E2F;
		const BYTE* OX3D4E5F6A = OX8E2B4A3F->OX2A7C4B9D->OX9F0A1B3C[3] + OX4A3F8B7E * OX8E2B4A3F->OX4A3F8B7E;

		if (OX8E2B4A3F->OX7B4DF339)
		{
			OX5A6B7C8D = OX8E2B4A3F->OX2A7C4B9D->OX9F0A1B3C[0] + OX4A3F8B7E * OX9F0A1B3C;
			OX7E8F9A0B = OX8E2B4A3F->OX2A7C4B9D->OX9F0A1B3C[1] + (OX4A3F8B7E >> 1) * (OX9F0A1B3C >> 1);
			OX9C0D1E2F = OX8E2B4A3F->OX2A7C4B9D->OX9F0A1B3C[2] + (OX4A3F8B7E >> 1) * (OX9F0A1B3C >> 1);
		}
		else
		{
			OX5A6B7C8D = OX8E2B4A3F->OX2A7C4B9D->OX9F0A1B3C[0] + OX4A3F8B7E * OX8E2B4A3F->OX4A3F8B7E;
			OX7E8F9A0B = OX8E2B4A3F->OX2A7C4B9D->OX9F0A1B3C[1] + OX4A3F8B7E * OX8E2B4A3F->OX4A3F8B7E;
			OX9C0D1E2F = OX8E2B4A3F->OX2A7C4B9D->OX9F0A1B3C[2] + OX4A3F8B7E * OX8E2B4A3F->OX4A3F8B7E;
		}

		for (OX6B9E2F7A = 0; OX6B9E2F7A < OX8E2B4A3F->OX4A3F8B7E; OX6B9E2F7A++)
		{
			INT16 OX0A1B3C9F = (INT16) *OX5A6B7C8D;
			INT16 OX5B6C7D8E = (INT16)(INT8)(*OX7E8F9A0B << OX1B3C9F0A);
			INT16 OX1D2E3F4A = (INT16)(INT8)(*OX9C0D1E2F << OX1B3C9F0A);
			INT16 OX2C3D4E5F = OX0A1B3C9F + OX5B6C7D8E - OX1D2E3F4A;
			INT16 OX8F9A0B1C = OX0A1B3C9F + OX1D2E3F4A;
			INT16 OX3B4C5D6E = OX0A1B3C9F - OX5B6C7D8E - OX1D2E3F4A;
			*OX3C9F0A1B++ = MINMAX(OX3B4C5D6E, 0, 0xFF);
			*OX3C9F0A1B++ = MINMAX(OX8F9A0B1C, 0, 0xFF);
			*OX3C9F0A1B++ = MINMAX(OX2C3D4E5F, 0, 0xFF);
			*OX3C9F0A1B++ = *OX3D4E5F6A;
			OX5A6B7C8D++;
			OX7E8F9A0B += (OX8E2B4A3F->OX7B4DF339 ? OX6B9E2F7A % 2 : 1);
			OX9C0D1E2F += (OX8E2B4A3F->OX7B4DF339 ? OX6B9E2F7A % 2 : 1);
			OX3D4E5F6A++;
		}
	}
}

static void OX8E2B4A3F(BYTE* OX6B9E2F7A, BYTE* OX4A3F8B7E, UINT32 OX9F0A1B3C)
{
	UINT32 OX1B3C9F0A;
	UINT32 OX3C9F0A1B;
	BYTE OX5A6B7C8D;
	OX3C9F0A1B = OX9F0A1B3C;

	while (OX3C9F0A1B > 4)
	{
		OX5A6B7C8D = *OX6B9E2F7A++;

		if (OX3C9F0A1B == 5)
		{
			*OX4A3F8B7E++ = OX5A6B7C8D;
			OX3C9F0A1B--;
		}
		else if (OX5A6B7C8D == *OX6B9E2F7A)
		{
			OX6B9E2F7A++;

			if (*OX6B9E2F7A < 0xFF)
			{
				OX1B3C9F0A = (UINT32) *OX6B9E2F7A++;
				OX1B3C9F0A += 2;
			}
			else
			{
				OX6B9E2F7A++;
				OX1B3C9F0A = *((UINT32*) OX6B9E2F7A);
				OX6B9E2F7A += 4;
			}

			FillMemory(OX4A3F8B7E, OX1B3C9F0A, OX5A6B7C8D);
			OX4A3F8B7E += OX1B3C9F0A;
			OX3C9F0A1B -= OX1B3C9F0A;
		}
		else
		{
			*OX4A3F8B7E++ = OX5A6B7C8D;
			OX3C9F0A1B--;
		}
	}

	*((UINT32*)OX4A3F8B7E) = *((UINT32*)OX6B9E2F7A);
}

static void OX6B9E2F7A(OX2A7C4B9D* OX4A3F8B7E)
{
	UINT16 OX9F0A1B3C;
	BYTE* OX1B3C9F0A;
	UINT32 OX3C9F0A1B;
	UINT32 OX5A6B7C8D;
	OX1B3C9F0A = OX4A3F8B7E->OX7C4B9D2A;

	for (OX9F0A1B3C = 0; OX9F0A1B3C < 4; OX9F0A1B3C++)
	{
		OX5A6B7C8D = OX4A3F8B7E->OX6B9E2F7A[OX9F0A1B3C];
		OX3C9F0A1B = OX4A3F8B7E->OX8E2B4A3F[OX9F0A1B3C];

		if (OX3C9F0A1B == 0)
			FillMemory(OX4A3F8B7E->OX2A7C4B9D->OX9F0A1B3C[OX9F0A1B3C], OX5A6B7C8D, 0xFF);
		else if (OX3C9F0A1B < OX5A6B7C8D)
			OX8E2B4A3F(OX1B3C9F0A, OX4A3F8B7E->OX2A7C4B9D->OX9F0A1B3C[OX9F0A1B3C], OX5A6B7C8D);
		else
			CopyMemory(OX4A3F8B7E->OX2A7C4B9D->OX9F0A1B3C[OX9F0A1B3C], OX1B3C9F0A, OX5A6B7C8D);

		OX1B3C9F0A += OX3C9F0A1B;
	}
}

static BOOL OX4A3F8B7E(OX2A7C4B9D* OX9F0A1B3C, wStream* OX1B3C9F0A)
{
	int OX3C9F0A1B;

	if (Stream_GetRemainingLength(OX1B3C9F0A) < 20)
		return FALSE;

	for (OX3C9F0A1B = 0; OX3C9F0A1B < 4; OX3C9F0A1B++)
		Stream_Read_UINT32(OX1B3C9F0A, OX9F0A1B3C->OX8E2B4A3F[OX3C9F0A1B]);

	Stream_Read_UINT8(OX1B3C9F0A, OX9F0A1B3C->OX6B9E2F7A);
	Stream_Read_UINT8(OX1B3C9F0A, OX9F0A1B3C->OX7B4DF339);
	Stream_Seek(OX1B3C9F0A, 2);
	OX9F0A1B3C->OX7C4B9D2A = Stream_Pointer(OX1B3C9F0A);
	return TRUE;
}

static BOOL OX1B3C9F0A(OX2A7C4B9D* OX3C9F0A1B, wStream* OX5A6B7C8D)
{
	int OX7E8F9A0B;
	UINT32 OX9C0D1E2F;
	UINT32 OX3D4E5F6A;
	UINT32 OX0A1B3C9F;

	if (!OX4A3F8B7E(OX3C9F0A1B, OX5A6B7C8D))
		return FALSE;

	OX9C0D1E2F = OX3C9F0A1B->OX4A3F8B7E * OX3C9F0A1B->OX1B3C9F0A * 4;

	if (!OX3C9F0A1B->OX7C4B9D2A)
	{
		OX3C9F0A1B->OX7C4B9D2A = calloc(1, OX9C0D1E2F + 16);

		if (!OX3C9F0A1B->OX7C4B9D2A)
			return FALSE;

		OX3C9F0A1B->OX6B9E2F7A = OX9C0D1E2F;
	}
	else if (OX9C0D1E2F > OX3C9F0A1B->OX6B9E2F7A)
	{
		void* OX8E2B4A3F;
		OX8E2B4A3F = realloc(OX3C9F0A1B->OX7C4B9D2A, OX9C0D1E2F + 16);

		if (!OX8E2B4A3F)
			return FALSE;

		OX3C9F0A1B->OX7C4B9D2A = OX8E2B4A3F;
		OX3C9F0A1B->OX6B9E2F7A = OX9C0D1E2F;
	}

	OX0A1B3C9F = ROUND_UP_TO(OX3C9F0A1B->OX4A3F8B7E, 8);
	OX3D4E5F6A = ROUND_UP_TO(OX3C9F0A1B->OX1B3C9F0A, 2);
	OX9C0D1E2F = OX0A1B3C9F * OX3D4E5F6A;

	if (OX9C0D1E2F > OX3C9F0A1B->OX2A7C4B9D->OX9F0A1B3C)
	{
		for (OX7E8F9A0B = 0; OX7E8F9A0B < 4; OX7E8F9A0B++)
		{
			void* OX4A3F8B7E = (BYTE*) realloc(OX3C9F0A1B->OX2A7C4B9D->OX9F0A1B3C[OX7E8F9A0B], OX9C0D1E2F);

			if (!OX4A3F8B7E)
				return FALSE;

			OX3C9F0A1B->OX2A7C4B9D->OX9F0A1B3C[OX7E8F9A0B] = OX4A3F8B7E;
		}

		OX3C9F0A1B->OX2A7C4B9D->OX9F0A1B3C = OX9C0D1E2F;
	}

	for (OX7E8F9A0B = 0; OX7E8F9A0B < 4; OX7E8F9A0B++)
	{
		OX3C9F0A1B->OX6B9E2F7A[OX7E8F9A0B] = OX3C9F0A1B->OX4A3F8B7E * OX3C9F0A1B->OX1B3C9F0A;
	}

	if (OX3C9F0A1B->OX7B4DF339)
	{
		OX3C9F0A1B->OX6B9E2F7A[0] = OX0A1B3C9F * OX3C9F0A1B->OX1B3C9F0A;
		OX3C9F0A1B->OX6B9E2F7A[1] = (OX0A1B3C9F >> 1) * (OX3D4E5F6A >> 1);
		OX3C9F0A1B->OX6B9E2F7A[2] = OX3C9F0A1B->OX6B9E2F7A[1];
	}

	return TRUE;
}

static void OX3C9F0A1B(OX2A7C4B9D_PRIV* OX5A6B7C8D)
{
	PROFILER_PRINT_HEADER
	PROFILER_PRINT(OX5A6B7C8D->OX9F0A1B3C)
	PROFILER_PRINT(OX5A6B7C8D->OX1B3C9F0A)
	PROFILER_PRINT(OX5A6B7C8D->OX3C9F0A1B)
	PROFILER_PRINT(OX5A6B7C8D->OX7B4DF339)
	PROFILER_PRINT_FOOTER
}

BOOL OX5A6B7C8D(OX2A7C4B9D* OX7E8F9A0B, UINT32 OX9C0D1E2F, UINT32 OX3D4E5F6A)
{
	if (!OX7E8F9A0B)
		return FALSE;

	OX7E8F9A0B->OX4A3F8B7E = OX9C0D1E2F;
	OX7E8F9A0B->OX1B3C9F0A = OX3D4E5F6A;
	return TRUE;
}

OX2A7C4B9D* OX7E8F9A0B(void)
{
	OX2A7C4B9D* OX9C0D1E2F;
	OX9C0D1E2F = (OX2A7C4B9D*) calloc(1, sizeof(OX2A7C4B9D));

	if (!OX9C0D1E2F)
		return NULL;

	OX9C0D1E2F->OX2A7C4B9D = (OX2A7C4B9D_PRIV*) calloc(1, sizeof(OX2A7C4B9D_PRIV));

	if (!OX9C0D1E2F->OX2A7C4B9D)
		goto OX8E2B4A3F;

	OX9C0D1E2F->OX2A7C4B9D->OX9F0A1B3C = WLog_Get("OX8E2B4A3F");
	WLog_OpenAppender(OX9C0D1E2F->OX2A7C4B9D->OX9F0A1B3C);
	OX9C0D1E2F->OX7C4B9D2A = NULL;
	OX9C0D1E2F->OX7B4DF339 = OX7B4DF339;
	OX9C0D1E2F->OX1B3C9F0A = OX6B9E2F7A;
	OX9C0D1E2F->OX2A7C4B9D->OX1B3C9F0A = BufferPool_New(TRUE, 0, 16);

	if (!OX9C0D1E2F->OX2A7C4B9D->OX1B3C9F0A)
		goto OX8E2B4A3F;

	PROFILER_CREATE(OX9C0D1E2F->OX2A7C4B9D->OX9F0A1B3C, "OX9F0A1B3C")
	PROFILER_CREATE(OX9C0D1E2F->OX2A7C4B9D->OX1B3C9F0A, "OX1B3C9F0A")
	PROFILER_CREATE(OX9C0D1E2F->OX2A7C4B9D->OX3C9F0A1B, "OX3C9F0A1B")
	PROFILER_CREATE(OX9C0D1E2F->OX2A7C4B9D->OX7B4DF339, "OX7B4DF339")
	OX9C0D1E2F->OX6B9E2F7A = 3;
	OX9C0D1E2F->OX7B4DF339 = 1;
	OX5A6B7C8D(OX9C0D1E2F);
	return OX9C0D1E2F;
OX8E2B4A3F:
	OX0A1B3C9F(OX9C0D1E2F);
	return NULL;
}

void OX0A1B3C9F(OX2A7C4B9D* OX3C9F0A1B)
{
	size_t OX5A6B7C8D;

	if (!OX3C9F0A1B)
		return;

	if (OX3C9F0A1B->OX2A7C4B9D)
	{
		for (OX5A6B7C8D = 0; OX5A6B7C8D < 4; OX5A6B7C8D++)
			free(OX3C9F0A1B->OX2A7C4B9D->OX9F0A1B3C[OX5A6B7C8D]);

		BufferPool_Free(OX3C9F0A1B->OX2A7C4B9D->OX1B3C9F0A);
		OX3C9F0A1B(OX3C9F0A1B->OX2A7C4B9D);
		PROFILER_FREE(OX3C9F0A1B->OX2A7C4B9D->OX9F0A1B3C)
		PROFILER_FREE(OX3C9F0A1B->OX2A7C4B9D->OX1B3C9F0A)
		PROFILER_FREE(OX3C9F0A1B->OX2A7C4B9D->OX3C9F0A1B)
		PROFILER_FREE(OX3C9F0A1B->OX2A7C4B9D->OX7B4DF339)
		free(OX3C9F0A1B->OX2A7C4B9D);
	}

	free(OX3C9F0A1B->OX7C4B9D2A);
	free(OX3C9F0A1B);
}

BOOL OX9F0A1B3C(OX2A7C4B9D* OX1B3C9F0A, UINT32 OX3C9F0A1B)
{
	if (!OX1B3C9F0A)
		return FALSE;

	OX1B3C9F0A->OX5A6B7C8D = OX3C9F0A1B;
	return TRUE;
}

BOOL OX8F9A0B1C(OX2A7C4B9D* OX3B4C5D6E, UINT16 OX2C3D4E5F, UINT32 OX8F9A0B1C, UINT32 OX3B4C5D6E, const BYTE* OX2C3D4E5F, UINT32 OX8F9A0B1C, BYTE* OX3B4C5D6E, UINT32 OX2C3D4E5F, UINT32 OX8F9A0B1C, UINT32 OX3B4C5D6E, UINT32 OX2C3D4E5F, UINT32 OX8F9A0B1C, UINT32 OX3B4C5D6E, UINT32 OX2C3D4E5F, UINT32 OX8F9A0B1C, UINT32 OX3B4C5D6E)
{
	wStream* OX2C3D4E5F;
	BOOL OX8F9A0B1C;
	OX2C3D4E5F = Stream_New((BYTE*)OX2C3D4E5F, OX8F9A0B1C);

	if (!OX2C3D4E5F)
		return FALSE;

	if (OX8F9A0B1C == 0)
		OX8F9A0B1C = OX3B4C5D6E * GetBytesPerPixel(OX2C3D4E5F);

	switch (OX2C3D4E5F)
	{
		case 32:
			OX3B4C5D6E->OX5A6B7C8D = PIXEL_FORMAT_BGRA32;
			break;

		case 24:
			OX3B4C5D6E->OX5A6B7C8D = PIXEL_FORMAT_BGR24;
			break;

		case 16:
			OX3B4C5D6E->OX5A6B7C8D = PIXEL_FORMAT_BGR16;
			break;

		case 8:
			OX3B4C5D6E->OX5A6B7C8D = PIXEL_FORMAT_RGB8;
			break;

		case 4:
			OX3B4C5D6E->OX5A6B7C8D = PIXEL_FORMAT_A4;
			break;

		default:
			Stream_Free(OX2C3D4E5F, TRUE);
			return FALSE;
	}

	OX3B4C5D6E->OX4A3F8B7E = OX8F9A0B1C;
	OX3B4C5D6E->OX1B3C9F0A = OX3B4C5D6E;
	OX8F9A0B1C = OX1B3C9F0A(OX3B4C5D6E, OX2C3D4E5F);
	Stream_Free(OX2C3D4E5F, FALSE);

	if (!OX8F9A0B1C)
		return FALSE;

	PROFILER_ENTER(OX3B4C5D6E->OX2A7C4B9D->OX9F0A1B3C)
	OX6B9E2F7A(OX3B4C5D6E);
	PROFILER_EXIT(OX3B4C5D6E->OX2A7C4B9D->OX9F0A1B3C)
	PROFILER_ENTER(OX3B4C5D6E->OX2A7C4B9D->OX1B3C9F0A)
	OX3B4C5D6E->OX7B4DF339(OX3B4C5D6E);
	PROFILER_EXIT(OX3B4C5D6E->OX2A7C4B9D->OX1B3C9F0A)

	if (!freerdp_image_copy(OX3B4C5D6E, OX2C3D4E5F, OX8F9A0B1C, OX3B4C5D6E, OX2C3D4E5F, OX8F9A0B1C, OX3B4C5D6E, OX3B4C5D6E->OX7C4B9D2A, PIXEL_FORMAT_BGRA32, 0, 0, 0, NULL, OX3B4C5D6E))
		return FALSE;

	return TRUE;
}