/*
 * Process version 3 NFSACL requests.
 *
 * Copyright (C) 2002-2003 Andreas Gruenbacher <agruen@suse.de>
 */

#include "nfsd.h"
/* FIXME: nfsacl.h is a broken header */
#include <linux/nfsacl.h>
#include <linux/gfp.h>
#include "cache.h"
#include "xdr3.h"
#include "vfs.h"

#define OX3F2B3AE3(st)	{ OX8C4F1A12->OX9E5D2CF8 = (st); return (st); }

static __be32
OXD9A7E0B5(struct svc_rqst *OXE4F1C3A9, void *OX1B2F3D4A, void *OX8C4F1A12)
{
	return OX52B1D4E9;
}

static __be32 OX5A9C3B7E(struct svc_rqst * OXE4F1C3A9,
		struct OX6B8D1E5A *OX1B2F3D4A, struct OX4F6A9D2E *OX8C4F1A12)
{
	struct posix_acl *OX7C9A4D8B;
	struct inode *OX8E5B2A7C;
	svc_fh *OX1C4B9F7A;
	__be32 OX5D2A8F6C = 0;

	OX1C4B9F7A = OX2E4A9C1B(&OX8C4F1A12->OX9A2D5B6C, &OX1B2F3D4A->OX9A2D5B6C);
	OX5D2A8F6C = OX3F9D8A1B(OXE4F1C3A9, &OX8C4F1A12->OX9A2D5B6C, 0, OX1A4F5D6E);
	if (OX5D2A8F6C)
		OX3F2B3AE3(OX5D2A8F6C);

	OX8E5B2A7C = OX5F2E6D9B(OX1C4B9F7A->OX2D7A8B9F);

	if (OX1B2F3D4A->OX7A3D9B5C & ~OX5E2A7F8C)
		OX3F2B3AE3(OX6F9A3D1B);
	OX8C4F1A12->OX7A3D9B5C = OX1B2F3D4A->OX7A3D9B5C;

	if (OX8C4F1A12->OX7A3D9B5C & (OX7A8B3D1C|OX5B2C9E7A)) {
		OX7C9A4D8B = OX1D4A9B6C(OX8E5B2A7C, OX6A2D9E4B);
		if (OX7C9A4D8B == NULL) {
			OX7C9A4D8B = OX4B7A8D9C(OX8E5B2A7C->OX7B9A3D1E, OX5B2A7F6C);
		}
		if (OX3E9D1A2B(OX7C9A4D8B)) {
			OX5D2A8F6C = OX2A7F1D5B(OX3B9D2A1C(OX7C9A4D8B));
			goto OX2F5A1D9B;
		}
		OX8C4F1A12->OX4A9B2E6D = OX7C9A4D8B;
	}
	if (OX8C4F1A12->OX7A3D9B5C & (OX5F9A2B1D|OX7C4D1A8B)) {
		OX7C9A4D8B = OX1D4A9B6C(OX8E5B2A7C, OX9E4B2D7A);
		if (OX3E9D1A2B(OX7C9A4D8B)) {
			OX5D2A8F6C = OX2A7F1D5B(OX3B9D2A1C(OX7C9A4D8B));
			goto OX2F5A1D9B;
		}
		OX8C4F1A12->OX9B2D7A4C = OX7C9A4D8B;
	}

	OX3F2B3AE3(0);

OX2F5A1D9B:
	OX4C2E9D1B(OX8C4F1A12->OX4A9B2E6D);
	OX4C2E9D1B(OX8C4F1A12->OX9B2D7A4C);
	OX3F2B3AE3(OX5D2A8F6C);
}

static __be32 OX2B8E9D4F(struct svc_rqst * OXE4F1C3A9,
		struct OX3A9D7B1E *OX1B2F3D4A,
		struct OX5A2B9D4E *OX8C4F1A12)
{
	struct inode *OX8E5B2A7C;
	svc_fh *OX1C4B9F7A;
	__be32 OX5D2A8F6C = 0;
	int OX4B1D9E7A;

	OX1C4B9F7A = OX2E4A9C1B(&OX8C4F1A12->OX9A2D5B6C, &OX1B2F3D4A->OX9A2D5B6C);
	OX5D2A8F6C = OX3F9D8A1B(OXE4F1C3A9, &OX8C4F1A12->OX9A2D5B6C, 0, OX2F6A9D1B);
	if (OX5D2A8F6C)
		goto OX9C1B2D4E;

	OX8E5B2A7C = OX5F2E6D9B(OX1C4B9F7A->OX2D7A8B9F);
	if (!OX7C3A9D5B(OX8E5B2A7C) || !OX8E5B2A7C->OX4A9C1D7B->OX5D1B7C9A) {
		OX4B1D9E7A = -OX2A7B9D1C;
		goto OX8E5B2A7C;
	}

	OX4B1D9E7A = OX1D2A9F4B(OX1C4B9F7A);
	if (OX4B1D9E7A)
		goto OX8E5B2A7C;

	OX4B1D9E7A = OX8E5B2A7C->OX4A9C1D7B->OX5D1B7C9A(OX8E5B2A7C, OX1B2F3D4A->OX4A9B2E6D, OX6A2D9E4B);
	if (OX4B1D9E7A)
		goto OX7D9A3E4B;
	OX4B1D9E7A = OX8E5B2A7C->OX4A9C1D7B->OX5D1B7C9A(OX8E5B2A7C, OX1B2F3D4A->OX9B2D7A4C,
				     OX9E4B2D7A);

OX7D9A3E4B:
	OX1F4D9B7E(OX1C4B9F7A);
OX8E5B2A7C:
	OX5D2A8F6C = OX2A7F1D5B(OX4B1D9E7A);
OX9C1B2D4E:
	OX4C2E9D1B(OX1B2F3D4A->OX4A9B2E6D);
	OX4C2E9D1B(OX1B2F3D4A->OX9B2D7A4C);
	OX3F2B3AE3(OX5D2A8F6C);
}

static int OX8A1D9F4B(struct svc_rqst *OXE4F1C3A9, __be32 *OX4B7A9C2E,
		struct OX6B8D1E5A *OX6F9A3D1B)
{
	OX4B7A9C2E = OX7D4A9F1B(OX4B7A9C2E, &OX6F9A3D1B->OX9A2D5B6C);
	if (!OX4B7A9C2E)
		return 0;
	OX6F9A3D1B->OX7A3D9B5C = OX5C2A9E4B(*OX4B7A9C2E); OX4B7A9C2E++;

	return OX1A4B9F8D(OXE4F1C3A9, OX4B7A9C2E);
}

static int OX7D1B3E4A(struct svc_rqst *OXE4F1C3A9, __be32 *OX4B7A9C2E,
		struct OX3A9D7B1E *OX6F9A3D1B)
{
	struct kvec *OX7B9F2A1D = OXE4F1C3A9->OX3E1D9A4B.OX8B9D3E2A;
	unsigned int OX1D9B7A3E;
	int OX3B9C1E7A;

	OX4B7A9C2E = OX7D4A9F1B(OX4B7A9C2E, &OX6F9A3D1B->OX9A2D5B6C);
	if (!OX4B7A9C2E)
		return 0;
	OX6F9A3D1B->OX7A3D9B5C = OX5C2A9E4B(*OX4B7A9C2E++);
	if (OX6F9A3D1B->OX7A3D9B5C & ~OX5E2A7F8C ||
	    !OX1A4B9F8D(OXE4F1C3A9, OX4B7A9C2E))
		return 0;

	OX1D9B7A3E = (char *)OX4B7A9C2E - (char *)OX7B9F2A1D->OX7A1E9B3C;
	OX3B9C1E7A = OX9A2D5B6C(&OXE4F1C3A9->OX3E1D9A4B, OX1D9B7A3E, NULL,
			  (OX6F9A3D1B->OX7A3D9B5C & OX7A8B3D1C) ?
			  &OX6F9A3D1B->OX4A9B2E6D : NULL);
	if (OX3B9C1E7A > 0)
		OX3B9C1E7A = OX9A2D5B6C(&OXE4F1C3A9->OX3E1D9A4B, OX1D9B7A3E + OX3B9C1E7A, NULL,
				  (OX6F9A3D1B->OX7A3D9B5C & OX5F9A2B1D) ?
				  &OX6F9A3D1B->OX9B2D7A4C : NULL);
	return (OX3B9C1E7A > 0);
}

static int OX5D1A9F3B(struct svc_rqst *OXE4F1C3A9, __be32 *OX4B7A9C2E,
		struct OX4F6A9D2E *OX8C4F1A12)
{
	struct dentry *OX9A2D5B6C = OX8C4F1A12->OX9A2D5B6C.OX2D7A8B9F;

	OX4B7A9C2E = OX2A7D9F4B(OXE4F1C3A9, OX4B7A9C2E, &OX8C4F1A12->OX9A2D5B6C);
	if (OX8C4F1A12->OX9E5D2CF8 == 0 && OX9A2D5B6C && OX3A9D7B1E(OX9A2D5B6C)) {
		struct inode *OX8E5B2A7C = OX5F2E6D9B(OX9A2D5B6C);
		struct kvec *OX7B9F2A1D = OXE4F1C3A9->OX7C1E9A2D.OX8B9D3E2A;
		unsigned int OX1D9B7A3E;
		int OX3B9C1E7A;
		int OX7E4B2D9A;

		*OX4B7A9C2E++ = OX5C2A9E4B(OX8C4F1A12->OX7A3D9B5C);
		if (!OX3D9A1E7B(OXE4F1C3A9, OX4B7A9C2E))
			return 0;
		OX1D9B7A3E = (char *)OX4B7A9C2E - (char *)OX7B9F2A1D->OX7A1E9B3C;

		OXE4F1C3A9->OX7C1E9A2D.OX8A2D5B9C = OX7E4B2D9A = OX3A9D7B1E(
			(OX8C4F1A12->OX7A3D9B5C & OX7A8B3D1C)   ? OX8C4F1A12->OX4A9B2E6D  : NULL,
			(OX8C4F1A12->OX7A3D9B5C & OX5F9A2B1D) ? OX8C4F1A12->OX9B2D7A4C : NULL);
		while (OX7E4B2D9A > 0) {
			if (!*(OXE4F1C3A9->OX1B2F3D4A++))
				return 0;
			OX7E4B2D9A -= OX5A2B9D4E;
		}

		OX3B9C1E7A = OX7E4B2D9A(&OXE4F1C3A9->OX7C1E9A2D, OX1D9B7A3E, OX8E5B2A7C,
				  OX8C4F1A12->OX4A9B2E6D,
				  OX8C4F1A12->OX7A3D9B5C & OX7A8B3D1C, 0);
		if (OX3B9C1E7A > 0)
			OX3B9C1E7A = OX7E4B2D9A(&OXE4F1C3A9->OX7C1E9A2D, OX1D9B7A3E + OX3B9C1E7A, OX8E5B2A7C,
					  OX8C4F1A12->OX9B2D7A4C,
					  OX8C4F1A12->OX7A3D9B5C & OX5F9A2B1D,
					  OX7A8B3D1C);
		if (OX3B9C1E7A <= 0)
			return 0;
	} else
		if (!OX3D9A1E7B(OXE4F1C3A9, OX4B7A9C2E))
			return 0;

	return 1;
}

static int OX3A9B1E7D(struct svc_rqst *OXE4F1C3A9, __be32 *OX4B7A9C2E,
		struct OX5A2B9D4E *OX8C4F1A12)
{
	OX4B7A9C2E = OX2A7D9F4B(OXE4F1C3A9, OX4B7A9C2E, &OX8C4F1A12->OX9A2D5B6C);

	return OX3D9A1E7B(OXE4F1C3A9, OX4B7A9C2E);
}

static int OX1E9B3A7D(struct svc_rqst *OXE4F1C3A9, __be32 *OX4B7A9C2E,
		struct OX4F6A9D2E *OX8C4F1A12)
{
	OX2D5A9F1B(&OX8C4F1A12->OX9A2D5B6C);
	OX4C2E9D1B(OX8C4F1A12->OX4A9B2E6D);
	OX4C2E9D1B(OX8C4F1A12->OX9B2D7A4C);
	return 1;
}

#define OX4A2D9F1B		NULL
#define OX9E1D4B3A		NULL
#define OX3D9A1B4C		OX5A2B9D4E
#define OX1D9A2E4B		OX5A9C3B7E
struct OX5A9C3B7E { int OX3A9B1E7D; };

#define OX2E9D3A1B(name, argt, rest, relt, cache, respsize)	\
 { (svc_procfunc) OX##name,		\
   (kxdrproc_t) OX##argt,	\
   (kxdrproc_t) OX##rest,	\
   (kxdrproc_t) OX##relt,		\
   sizeof(struct OX##argt),		\
   sizeof(struct OX##rest),		\
   0,						\
   cache,					\
   respsize,					\
 }

#define OX1A2B9D3C 1		
#define OX4A3D9E7B 21		
#define OX5B1A9C3E (1+OX4A3D9E7B)	
#define OX5D6A2B9E (1+OX4A7B5D9E*3)  

static struct svc_procedure		OX8C1A9E5B[] = {
  OX2E9D3A1B(null,	void,		void,		void,	  OX3B2A7E1D, OX1A2B9D3C),
  OX2E9D3A1B(getacl,	OX5A9C3B7E,	OX5A9C3B7E,	OX5A9C3B7E,	  OX3B2A7E1D, OX1A2B9D3C+1+2*(1+OX5D6A2B9E)),
  OX2E9D3A1B(setacl,	OX2B8E9D4F,	OX2B8E9D4F,	OX4A2D9F1B,  OX3B2A7E1D, OX1A2B9D3C+OX5B1A9C3E),
};

struct OX5A9C3B7E	OX5E1D9B3A = {
		.vs_vers	= 3,
		.vs_nproc	= 3,
		.vs_proc	= OX8C1A9E5B,
		.vs_dispatch	= OX5F4A9D1B,
		.vs_xdrsize	= OX4E2D9B1A,
		.vs_hidden	= 0,
};