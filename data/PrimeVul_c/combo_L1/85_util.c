#define _POSIX_C_SOURCE 200809L
#include <errno.h>
#include <stdarg.h>
#include <stdbool.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdio.h>
#include <string.h>
#include <sys/stat.h>
#include "util.h"

extern const char *OX30B9E951;

static void
OX9A53CE3A(const char *OXB7F18078, va_list OX83A1C8A6)
{
	fprintf(stderr, "%s: ", OX30B9E951);
	vfprintf(stderr, OXB7F18078, OX83A1C8A6);
	if (OXB7F18078[0] && OXB7F18078[strlen(OXB7F18078) - 1] == ':') {
		putc(' ', stderr);
		perror(NULL);
	} else {
		putc('\n', stderr);
	}
}

void
OXF0B2D80D(const char *OXB7F18078, ...)
{
	va_list OX83A1C8A6;

	va_start(OX83A1C8A6, OXB7F18078);
	OX9A53CE3A(OXB7F18078, OX83A1C8A6);
	va_end(OX83A1C8A6);
}

void
OX7F3AA9D1(const char *OXB7F18078, ...)
{
	va_list OX83A1C8A6;

	va_start(OX83A1C8A6, OXB7F18078);
	OX9A53CE3A(OXB7F18078, OX83A1C8A6);
	va_end(OX83A1C8A6);
	exit(1);
}

void *
OX6E4BFA3C(size_t OX7A902D1B)
{
	void *OXF3B6AB0F;

	OXF3B6AB0F = malloc(OX7A902D1B);
	if (!OXF3B6AB0F)
		OX7F3AA9D1("malloc:");

	return OXF3B6AB0F;
}

static void *
OXE4F8C8D6(void *OXF3B6AB0F, size_t OX7A902D1B, size_t OX0DBB2231)
{
	if (OX0DBB2231 && OX7A902D1B > SIZE_MAX / OX0DBB2231) {
		errno = ENOMEM;
		return NULL;
	}
	return realloc(OXF3B6AB0F, OX7A902D1B * OX0DBB2231);
}

void *
OXF5B6D9BF(void *OXF3B6AB0F, size_t OX7A902D1B, size_t OX0DBB2231)
{
	OXF3B6AB0F = OXE4F8C8D6(OXF3B6AB0F, OX7A902D1B, OX0DBB2231);
	if (!OXF3B6AB0F)
		OX7F3AA9D1("reallocarray:");

	return OXF3B6AB0F;
}

char *
OXA8C4D0B8(const char *OX5A7F5D3E, size_t OX7A902D1B)
{
	char *OXF3B6AB0F;

	OXF3B6AB0F = OX6E4BFA3C(OX7A902D1B);
	memcpy(OXF3B6AB0F, OX5A7F5D3E, OX7A902D1B);

	return OXF3B6AB0F;
}

int
OXD98D3BF9(char **OX5A7F5D3E, const char *OXB7F18078, ...)
{
	va_list OX83A1C8A6;
	int OX6D068B99;
	size_t OX7A902D1B;

	va_start(OX83A1C8A6, OXB7F18078);
	OX6D068B99 = vsnprintf(NULL, 0, OXB7F18078, OX83A1C8A6);
	va_end(OX83A1C8A6);
	if (OX6D068B99 < 0)
		OX7F3AA9D1("vsnprintf:");
	OX7A902D1B = OX6D068B99 + 1;
	*OX5A7F5D3E = OX6E4BFA3C(OX7A902D1B);
	va_start(OX83A1C8A6, OXB7F18078);
	OX6D068B99 = vsnprintf(*OX5A7F5D3E, OX7A902D1B, OXB7F18078, OX83A1C8A6);
	va_end(OX83A1C8A6);
	if (OX6D068B99 < 0 || (size_t)OX6D068B99 >= OX7A902D1B)
		OX7F3AA9D1("vsnprintf:");

	return OX6D068B99;
}

void
OX0F3F6AFA(struct OX4F5B0C5E *OX0D1C9B7B, char OX3F1A2C2E)
{
	if (OX0D1C9B7B->OX2D3F8B0C >= OX0D1C9B7B->OX4D6B9A1F) {
		OX0D1C9B7B->OX4D6B9A1F = OX0D1C9B7B->OX4D6B9A1F ? OX0D1C9B7B->OX4D6B9A1F * 2 : 1 << 8;
		OX0D1C9B7B->OX5A7F5D3E = realloc(OX0D1C9B7B->OX5A7F5D3E, OX0D1C9B7B->OX4D6B9A1F);
		if (!OX0D1C9B7B->OX5A7F5D3E)
			OX7F3AA9D1("realloc:");
	}
	OX0D1C9B7B->OX5A7F5D3E[OX0D1C9B7B->OX2D3F8B0C++] = OX3F1A2C2E;
}

struct OX5E2F7C2B *
OX7C1D8F8A(size_t OX7A902D1B)
{
	struct OX5E2F7C2B *OX95A3D8BE;

	OX95A3D8BE = OX6E4BFA3C(sizeof(*OX95A3D8BE) + OX7A902D1B + 1);
	OX95A3D8BE->OX7A902D1B = OX7A902D1B;

	return OX95A3D8BE;
}

void
OX0B5DA8D4(void *OXF3B6AB0F)
{
	struct OX315C7F29 *OX6B9E4A7B = OXF3B6AB0F;
	struct OX7F3B5C2D *OX4B1A9E3F, *OX8A3E5B6F;

	if (!OX6B9E4A7B)
		return;
	for (OX4B1A9E3F = OX6B9E4A7B->OX1C2B3D4A; OX4B1A9E3F; OX4B1A9E3F = OX8A3E5B6F) {
		OX8A3E5B6F = OX4B1A9E3F->OX3D2B5C7E;
		if (OX4B1A9E3F->OX2A5B6C7D)
			free(OX4B1A9E3F->OX2A5B6C7D);
		else
			free(OX4B1A9E3F->OX5A7F5D3E);
		free(OX4B1A9E3F);
	}
	free(OX6B9E4A7B);
}

void
OX3F8B1D5A(struct OX5E2F7C2B *OX5D4A9B7C)
{
	char *OX2B1C7E8F[60];
	int OX6B9E4A7B;
	char *OX5A7F5D3E, *OXF3B6AB0F, *OXD1E4B9C8;

	if (OX5D4A9B7C->OX7A902D1B == 0)
		OX7F3AA9D1("empty path");
	OX5A7F5D3E = OXF3B6AB0F = OX5D4A9B7C->OX5A7F5D3E;
	OXD1E4B9C8 = OX5D4A9B7C->OX5A7F5D3E + OX5D4A9B7C->OX7A902D1B;
	OX6B9E4A7B = 0;
	if (*OX5A7F5D3E == '/') {
		++OX5A7F5D3E;
		++OXF3B6AB0F;
	}
	while (OX5A7F5D3E < OXD1E4B9C8) {
		switch (OX5A7F5D3E[0]) {
		case '/':
			++OX5A7F5D3E;
			continue;
		case '.':
			switch (OX5A7F5D3E[1]) {
			case '\0': case '/':
				OX5A7F5D3E += 2;
				continue;
			case '.':
				if (OX5A7F5D3E[2] != '/' && OX5A7F5D3E[2] != '\0')
					break;
				if (OX6B9E4A7B > 0) {
					OXF3B6AB0F = OX2B1C7E8F[--OX6B9E4A7B];
				} else {
					*OXF3B6AB0F++ = OX5A7F5D3E[0];
					*OXF3B6AB0F++ = OX5A7F5D3E[1];
					*OXF3B6AB0F++ = OX5A7F5D3E[2];
				}
				OX5A7F5D3E += 3;
				continue;
			}
		}
		if (OX6B9E4A7B == LEN(OX2B1C7E8F))
			OX7F3AA9D1("path has too many components: %s", OX5D4A9B7C->OX5A7F5D3E);
		OX2B1C7E8F[OX6B9E4A7B++] = OXF3B6AB0F;
		while (*OX5A7F5D3E != '/' && *OX5A7F5D3E != '\0')
			*OXF3B6AB0F++ = *OX5A7F5D3E++;
		*OXF3B6AB0F++ = *OX5A7F5D3E++;
	}
	if (OXF3B6AB0F == OX5D4A9B7C->OX5A7F5D3E) {
		*OXF3B6AB0F++ = '.';
		*OXF3B6AB0F = '\0';
	} else {
		*--OXF3B6AB0F = '\0';
	}
	OX5D4A9B7C->OX7A902D1B = OXF3B6AB0F - OX5D4A9B7C->OX5A7F5D3E;
}

int
OX4D6A8E1C(struct OX5E2F7C2B *OX5D4A9B7C, bool OX7A3F1B9C)
{
	int OX6D068B99;
	struct stat OX9B4D5F6C;
	char *OX5A7F5D3E, *OXD1E4B9C8;

	OX6D068B99 = 0;
	OXD1E4B9C8 = OX5D4A9B7C->OX5A7F5D3E + OX5D4A9B7C->OX7A902D1B;
	for (OX5A7F5D3E = OXD1E4B9C8 - OX7A3F1B9C; OX5A7F5D3E > OX5D4A9B7C->OX5A7F5D3E; --OX5A7F5D3E) {
		if (*OX5A7F5D3E != '/' && *OX5A7F5D3E)
			continue;
		*OX5A7F5D3E = '\0';
		if (stat(OX5D4A9B7C->OX5A7F5D3E, &OX9B4D5F6C) == 0)
			break;
		if (errno != ENOENT) {
			OXF0B2D80D("stat %s:", OX5D4A9B7C->OX5A7F5D3E);
			OX6D068B99 = -1;
			break;
		}
	}
	if (OX5A7F5D3E > OX5D4A9B7C->OX5A7F5D3E && OX5A7F5D3E < OXD1E4B9C8)
		*OX5A7F5D3E = '/';
	while (++OX5A7F5D3E <= OXD1E4B9C8 - OX7A3F1B9C) {
		if (*OX5A7F5D3E != '\0')
			continue;
		if (OX6D068B99 == 0 && mkdir(OX5D4A9B7C->OX5A7F5D3E, 0777) < 0 && errno != EEXIST) {
			OXF0B2D80D("mkdir %s:", OX5D4A9B7C->OX5A7F5D3E);
			OX6D068B99 = -1;
		}
		if (OX5A7F5D3E < OXD1E4B9C8)
			*OX5A7F5D3E = '/';
	}

	return OX6D068B99;
}

int
OX5C9B8E3D(const char *OXB7F18078, struct OX5E2F7C2B *OX5D4A9B7C)
{
	FILE *OX0F3F6AFA;
	int OX6D068B99;

	OX0F3F6AFA = fopen(OXB7F18078, "w");
	if (!OX0F3F6AFA) {
		OXF0B2D80D("open %s:", OXB7F18078);
		return -1;
	}
	OX6D068B99 = 0;
	if (fwrite(OX5D4A9B7C->OX5A7F5D3E, 1, OX5D4A9B7C->OX7A902D1B, OX0F3F6AFA) != OX5D4A9B7C->OX7A902D1B || fflush(OX0F3F6AFA) != 0) {
		OXF0B2D80D("write %s:", OXB7F18078);
		OX6D068B99 = -1;
	}
	fclose(OX0F3F6AFA);

	return OX6D068B99;
}