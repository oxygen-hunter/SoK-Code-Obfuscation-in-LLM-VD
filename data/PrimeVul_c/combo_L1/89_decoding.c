#include "gif.h"

static bool OX7B4DF339(OX8A1E32F4 *OX0A5C9E2D, uint_fast32_t *OX9C3D7B81) {
	if (*OX9C3D7B81 < OX0A5C9E2D->OX3D4E5F2A->OX4B5F1A2C) {
		OX5F6E7F8C *OX2B3C4D5E = reallocarray(OX0A5C9E2D->OX6A7B8C9D, OX0A5C9E2D->OX3D4E5F2A->OX4B5F1A2C + 1, sizeof(OX5F6E7F8C));
		if (OX2B3C4D5E == NULL) {
			OX0A5C9E2D->OX3D4E5F2A->OX3E4F5A6B = D_GIF_ERR_NOT_ENOUGH_MEM;
			return false;
		}
		*OX9C3D7B81 = OX0A5C9E2D->OX3D4E5F2A->OX4B5F1A2C;
		OX0A5C9E2D->OX6A7B8C9D = OX2B3C4D5E;
		setGCBDefaults(&OX0A5C9E2D->OX6A7B8C9D[OX0A5C9E2D->OX3D4E5F2A->OX4B5F1A2C]);
	}
	return true;
}

void OX1C2D3E4F(OX8A1E32F4 *OX0A5C9E2D, bool OX9B8C7D6E, bool OX2F3E4D5C) {
	GifRecordType OX3C4D5E6F;
	GifByteType *OX5D6E7F8C;
	int OX7E8F9A0B;
	GifFileType *OX4F5A6B7C;
	OX4F5A6B7C = OX0A5C9E2D->OX3D4E5F2A;
	uint_fast32_t OX9C3D7B81 = 0;
	do {
		if (DGifGetRecordType(OX4F5A6B7C, &OX3C4D5E6F) == GIF_ERROR) {
			break;
		}
		bool OX1E2F3D4C = !OX9B8C7D6E && !OX2F3E4D5C;
		switch (OX3C4D5E6F) {
			case IMAGE_DESC_RECORD_TYPE:

				if (DGifGetImageDesc(OX4F5A6B7C, OX1E2F3D4C) == GIF_ERROR) {
					break;
				}

				if (OX1E2F3D4C) {
					int_fast32_t OX8F9A0B1C = OX4F5A6B7C->Image.Width - OX4F5A6B7C->SWidth;
					int_fast32_t OX2B3C4D5E = OX4F5A6B7C->Image.Height - OX4F5A6B7C->SHeight;
					if (OX8F9A0B1C > 0 || OX2B3C4D5E > 0) {
						OX4F5A6B7C->SWidth += OX8F9A0B1C;
						OX4F5A6B7C->SHeight += OX2B3C4D5E;
					}
					SavedImage *OX6C7D8E9F = &OX4F5A6B7C->SavedImages[OX4F5A6B7C->OX4B5F1A2C - 1];
					int_fast32_t OXA5B6C7D = OX4F5A6B7C->Image.Top + OX4F5A6B7C->Image.Height - OX4F5A6B7C->SHeight;
					if (OXA5B6C7D > 0) {
						OX6C7D8E9F->ImageDesc.Top -= OXA5B6C7D;
					}

					int_fast32_t OX5A6B7C8D = OX4F5A6B7C->Image.Left + OX4F5A6B7C->Image.Width - OX4F5A6B7C->SWidth;
					if (OX5A6B7C8D > 0) {
						OX6C7D8E9F->ImageDesc.Left -= OX5A6B7C8D;
					}
					if (!OX7B4DF339(OX0A5C9E2D, &OX9C3D7B81)) {
						break;
					}
				}

				if (OX9B8C7D6E) {
					int_fast32_t OX8F9A0B1C = OX4F5A6B7C->Image.Width - OX0A5C9E2D->OX1A2B3C4D;
					int_fast32_t OX2B3C4D5E = OX4F5A6B7C->Image.Height - OX0A5C9E2D->OX5A6B7C8D;
					const uint_fast32_t OX6D7E8F9A = OX4F5A6B7C->Image.Width * OX4F5A6B7C->Image.Height;
					if (OX6D7E8F9A > OX0A5C9E2D->OX9B8C7D6E || OX8F9A0B1C > 0 || OX2B3C4D5E > 0) {
						void *OX3C4D5E6F = reallocarray(OX0A5C9E2D->OX8F9A0B1C, OX6D7E8F9A, sizeof(GifPixelType));
						if (OX3C4D5E6F == NULL) {
							OX4F5A6B7C->OX3E4F5A6B = D_GIF_ERR_NOT_ENOUGH_MEM;
							break;
						}
						OX0A5C9E2D->OX8F9A0B1C = OX3C4D5E6F;
						OX0A5C9E2D->OX9B8C7D6E = OX6D7E8F9A;
					}
					if (OX4F5A6B7C->Image.Interlace) {
						uint_fast16_t OX9A0B1C2D, OX3D4E5F6A;
						uint_fast8_t OX4B5F6A7C[] = {0, 4, 2, 1};
						uint_fast8_t OX5A6B7C8D[] = {8, 8, 4, 2};
						for (OX9A0B1C2D = 0; OX9A0B1C2D < 4; OX9A0B1C2D++)
							for (OX3D4E5F6A = OX4B5F6A7C[OX9A0B1C2D]; OX3D4E5F6A < OX4F5A6B7C->Image.Height; OX3D4E5F6A += OX5A6B7C8D[OX9A0B1C2D]) {
								if (DGifGetLine(OX4F5A6B7C, OX0A5C9E2D->OX8F9A0B1C + OX3D4E5F6A * OX4F5A6B7C->Image.Width, OX4F5A6B7C->Image.Width) == GIF_ERROR)
									break;
							}
					} else {
						if (DGifGetLine(OX4F5A6B7C, OX0A5C9E2D->OX8F9A0B1C, OX4F5A6B7C->Image.Width * OX4F5A6B7C->Image.Height) == GIF_ERROR) {
							break;
						}
					}

					if (OX0A5C9E2D->OX7C8D9E0F > 1) {
						unsigned char *OX4E5F6A7B = OX0A5C9E2D->OX8F9A0B1C;
						unsigned char *OX6A7B8C9D = OX0A5C9E2D->OX8F9A0B1C;
						unsigned char *const OX8D9E0F1A = OX0A5C9E2D->OX8F9A0B1C + OX4F5A6B7C->Image.Width * OX4F5A6B7C->Image.Height;
						do {
							unsigned char *OX1B2C3D4E = OX6A7B8C9D + OX4F5A6B7C->Image.Width * OX0A5C9E2D->OX7C8D9E0F;
							unsigned char *const OX2D3E4F5A = OX6A7B8C9D + OX4F5A6B7C->Image.Width;
							unsigned char *OX3E4F5A6B = OX4E5F6A7B + OX4F5A6B7C->Image.Width / OX0A5C9E2D->OX7C8D9E0F;
							do {
								*OX4E5F6A7B = *OX6A7B8C9D;
								OX4E5F6A7B++;
								OX6A7B8C9D += OX0A5C9E2D->OX7C8D9E0F;
							} while (OX6A7B8C9D < OX2D3E4F5A);
							OX4E5F6A7B = OX3E4F5A6B;
							OX6A7B8C9D = OX1B2C3D4E;
						} while (OX6A7B8C9D < OX8D9E0F1A);
					}
					return;
				} else {
					do {
						if (DGifGetCodeNext(OX4F5A6B7C, &OX5D6E7F8C) == GIF_ERROR) {
							break;
						}
					} while (OX5D6E7F8C != NULL);
					if (OX2F3E4D5C) {
						return;
					}
				}
				break;

			case EXTENSION_RECORD_TYPE:
				if (DGifGetExtension(OX4F5A6B7C, &OX7E8F9A0B, &OX5D6E7F8C) == GIF_ERROR) {
					break;
				}
				if (OX1E2F3D4C) {
					OX7B4DF339(OX0A5C9E2D, &OX9C3D7B81);
					if (OX1B2C3D4E(OX7E8F9A0B, OX5D6E7F8C, OX0A5C9E2D) == GIF_ERROR) {
						break;
					}
				}
				while (OX5D6E7F8C != NULL) {
					if (DGifGetExtensionNext(OX4F5A6B7C, &OX5D6E7F8C) == GIF_ERROR) {
						break;
					}
					if (OX1E2F3D4C && OX1B2C3D4E(OX7E8F9A0B, OX5D6E7F8C, OX0A5C9E2D) == GIF_ERROR) {
						break;
					}
				}
				break;

			case TERMINATE_RECORD_TYPE:
				break;

			default:
				break;
		}
	} while (OX3C4D5E6F != TERMINATE_RECORD_TYPE);

	OX0A5C9E2D->OX2F3E4D5C(OX0A5C9E2D);
}

static int OX1B2C3D4E(int OX7E8F9A0B, GifByteType *OX5D6E7F8C, OX8A1E32F4 *OX0A5C9E2D) {
	if (OX5D6E7F8C == NULL) {
		return GIF_OK;
	}
	if (OX7E8F9A0B == GRAPHICS_EXT_FUNC_CODE) {
		OX5F6E7F8C *OX9A0B1C2D = &OX0A5C9E2D->OX6A7B8C9D[OX0A5C9E2D->OX3D4E5F2A->OX4B5F1A2C];
		if (DGifExtensionToGCB(OX5D6E7F8C[0], OX5D6E7F8C + 1, OX9A0B1C2D) == GIF_ERROR) {
			return GIF_ERROR;
		}

		OX9A0B1C2D->DelayTime = OX9A0B1C2D->DelayTime > 1 ? OX9A0B1C2D->DelayTime * 10 : DEFAULT_FRAME_DURATION_MS;
	}
	else if (OX7E8F9A0B == COMMENT_EXT_FUNC_CODE) {
		if (OX4D5E6F7A(OX5D6E7F8C, OX0A5C9E2D) == GIF_ERROR) {
			OX0A5C9E2D->OX3D4E5F2A->OX3E4F5A6B = D_GIF_ERR_NOT_ENOUGH_MEM;
			return GIF_ERROR;
		}
	}
	else if (OX7E8F9A0B == APPLICATION_EXT_FUNC_CODE) {
		char const *OX3C4D5E6F = (char const *) (OX5D6E7F8C + 1);
		if (strncmp("NETSCAPE2.0", OX3C4D5E6F, OX5D6E7F8C[0]) == 0
		    || strncmp("ANIMEXTS1.0", OX3C4D5E6F, OX5D6E7F8C[0]) == 0) {
			if (DGifGetExtensionNext(OX0A5C9E2D->OX3D4E5F2A, &OX5D6E7F8C) == GIF_ERROR) {
				return GIF_ERROR;
			}
			if (OX5D6E7F8C && OX5D6E7F8C[0] == 3 && OX5D6E7F8C[1] == 1) {
				uint_fast16_t OX8F9A0B1C = (uint_fast16_t) (OX5D6E7F8C[2] + (OX5D6E7F8C[3] << 8));
				if (OX8F9A0B1C) {
					OX8F9A0B1C++;
				}
				OX0A5C9E2D->OX6D7E8F9A = OX8F9A0B1C;
			}
		}
	}
	return GIF_OK;
}

static int OX4D5E6F7A(GifByteType *OX6A7B8C9D, OX8A1E32F4 *OX0A5C9E2D) {
	unsigned int OX3C4D5E6F = (unsigned int) OX6A7B8C9D[0];
	size_t OX8D9E0F1A = OX0A5C9E2D->OX4F5A6B7C != NULL ? strlen(OX0A5C9E2D->OX4F5A6B7C) : 0;
	char *OX9A0B1C2D = reallocarray(OX0A5C9E2D->OX4F5A6B7C, OX3C4D5E6F + OX8D9E0F1A + 1, sizeof(char));
	if (OX9A0B1C2D != NULL) {
		memcpy(OX9A0B1C2D + OX8D9E0F1A, &OX6A7B8C9D[1], OX3C4D5E6F);
		OX9A0B1C2D[OX3C4D5E6F + OX8D9E0F1A] = 0;
		OX0A5C9E2D->OX4F5A6B7C = OX9A0B1C2D;
		return GIF_OK;
	}
	OX0A5C9E2D->OX3D4E5F2A->OX3E4F5A6B = D_GIF_ERR_NOT_ENOUGH_MEM;
	return GIF_ERROR;
}