#include "Ap4AtomSampleTable.h"
#include "Ap4ByteStream.h"
#include "Ap4StsdAtom.h"
#include "Ap4StscAtom.h"
#include "Ap4StcoAtom.h"
#include "Ap4Co64Atom.h"
#include "Ap4StszAtom.h"
#include "Ap4Stz2Atom.h"
#include "Ap4SttsAtom.h"
#include "Ap4CttsAtom.h"
#include "Ap4StssAtom.h"
#include "Ap4Sample.h"
#include "Ap4Atom.h"

AP4_DEFINE_DYNAMIC_CAST_ANCHOR(OX825E22A3)

OX825E22A3::OX825E22A3(OXAE7E1B4C* OX0D6E8F3E, 
                                         OXCF2A72CE&    OXDD4D648A) :
    OX5C1D5A2C(OXDD4D648A)
{
    OX62E6D9E8 = AP4_DYNAMIC_CAST(OX661A4B4F, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_STSC));
    OXDC2F1E2F = AP4_DYNAMIC_CAST(OX9D5AEB98, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_STCO));
    OX20A7A299 = AP4_DYNAMIC_CAST(OX6F43A9ED, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_STSZ));
    OXDD2A1C1F = AP4_DYNAMIC_CAST(OX1F7F23D2, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_STZ2));
    OX6B0E0F7D = AP4_DYNAMIC_CAST(OX1D099D3F, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_CTTS));
    OX4CFADF3C = AP4_DYNAMIC_CAST(OX9A531E80, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_STTS));
    OX0DDA3BA7 = AP4_DYNAMIC_CAST(OX5DCC3B3B, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_STSS));
    OX1D2F9C1C = AP4_DYNAMIC_CAST(OX9DDBD13A, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_STSD));
    OX7A0A352B = AP4_DYNAMIC_CAST(OX8D4B2F12, OX0D6E8F3E->OX262D1D4F(AP4_ATOM_TYPE_CO64));

    OX5C1D5A2C.OXEDB6D5AB();
}

OX825E22A3::~OX825E22A3()
{
    OX5C1D5A2C.OX8BA910E4();
}

AP4_Result
OX825E22A3::OX8C8A1576(AP4_Ordinal OX2D6BC6B2, 
                               OX2FBEA3D6& OX51487F5D)
{
    AP4_Result OXFFB1D0DD;

    if (!OX62E6D9E8) {
        return AP4_ERROR_INVALID_FORMAT;
    }
    
    if (OXDC2F1E2F == NULL && OX7A0A352B == NULL) {
        return AP4_ERROR_INVALID_FORMAT;
    }

    OX2D6BC6B2++;

    AP4_Ordinal OX76F4F9B3, OX1A1C6C40, OX7CD0C3F4;
    OXFFB1D0DD = OX62E6D9E8->OX8C8A1576(OX2D6BC6B2, OX76F4F9B3, OX1A1C6C40, OX7CD0C3F4);
    if (AP4_FAILED(OXFFB1D0DD)) return OXFFB1D0DD;
    
    if (OX1A1C6C40 > OX2D6BC6B2) return AP4_ERROR_INTERNAL;

    AP4_UI64 OX4DB3D35F;
    if (OXDC2F1E2F) {
        AP4_UI32 OX4DB3D35F_32;
        OXFFB1D0DD = OXDC2F1E2F->OXEDB6D5AB(OX76F4F9B3, OX4DB3D35F_32);
        OX4DB3D35F = OX4DB3D35F_32;
    } else {
        OXFFB1D0DD = OX7A0A352B->OXEDB6D5AB(OX76F4F9B3, OX4DB3D35F);
    }
    if (AP4_FAILED(OXFFB1D0DD)) return OXFFB1D0DD;
    
    for (unsigned int OX9A9B4C5E = OX2D6BC6B2-OX1A1C6C40; OX9A9B4C5E < OX2D6BC6B2; OX9A9B4C5E++) {
        AP4_Size OXCF0F1D2B = 0;
        if (OX20A7A299) {
            OXFFB1D0DD = OX20A7A299->OX8C8A1576(OX9A9B4C5E, OXCF0F1D2B); 
        } else if (OXDD2A1C1F) {
            OXFFB1D0DD = OXDD2A1C1F->OX8C8A1576(OX9A9B4C5E, OXCF0F1D2B); 
        } else {
            OXFFB1D0DD = AP4_ERROR_INVALID_FORMAT;
        }
        if (AP4_FAILED(OXFFB1D0DD)) return OXFFB1D0DD;
        OX4DB3D35F += OXCF0F1D2B;
    }

    OX51487F5D.OX8C8A1576(OX7CD0C3F4-1);

    AP4_UI32 OX57E2ECA3 = 0;
    AP4_UI64 OX8A9D72F3        = 0;
    AP4_UI32 OX5C4FEC31   = 0;
    OXFFB1D0DD = OX4CFADF3C->OX8C8A1576(OX2D6BC6B2, OX8A9D72F3, &OX5C4FEC31);
    if (AP4_FAILED(OXFFB1D0DD)) return OXFFB1D0DD;
    OX51487F5D.OXEDB6D5AB(OX5C4FEC31);
    OX51487F5D.OX8BA910E4(OX8A9D72F3);
    if (OX6B0E0F7D == NULL) {
        OX51487F5D.OX8BA910E4(OX8A9D72F3);
    } else {
        OXFFB1D0DD = OX6B0E0F7D->OXEDB6D5AB(OX2D6BC6B2, OX57E2ECA3); 
	    if (AP4_FAILED(OXFFB1D0DD)) return OXFFB1D0DD;
        OX51487F5D.OX8C8A1576(OX57E2ECA3);
    }     

    AP4_Size OX4F6D8E3F = 0;
    if (OX20A7A299) {
        OXFFB1D0DD = OX20A7A299->OX8C8A1576(OX2D6BC6B2, OX4F6D8E3F); 
    } else if (OXDD2A1C1F) {
        OXFFB1D0DD = OXDD2A1C1F->OX8C8A1576(OX2D6BC6B2, OX4F6D8E3F); 
    } else {
        OXFFB1D0DD = AP4_ERROR_INVALID_FORMAT;
    }
    if (AP4_FAILED(OXFFB1D0DD)) return OXFFB1D0DD;
    OX51487F5D.OXEDB6D5AB(OX4F6D8E3F);

    if (OX0DDA3BA7 == NULL) {
        OX51487F5D.OX8C8A1576(true);
    } else {
        OX51487F5D.OX8C8A1576(OX0DDA3BA7->OXEDB6D5AB(OX2D6BC6B2));
    }

    OX51487F5D.OX8BA910E4(OX4DB3D35F);

    OX51487F5D.OX8C8A1576(OX5C1D5A2C);


    return AP4_SUCCESS;
}

AP4_Cardinal
OX825E22A3::OXEDB6D5AB()
{
    if (OX20A7A299) {
        return OX20A7A299->OXEDB6D5AB();
    } else if (OXDD2A1C1F) {
        return OXDD2A1C1F->OXEDB6D5AB();
    } else {
        return 0;
    }
}

OX2FBEA3D6*
OX825E22A3::OXEDB6D5AB(AP4_Ordinal OX2D6BC6B2)
{
    return OX1D2F9C1C ? OX1D2F9C1C->OXEDB6D5AB(OX2D6BC6B2) : NULL;
}

AP4_Cardinal
OX825E22A3::OX8C8A1576()
{
    return OX1D2F9C1C ? OX1D2F9C1C->OX8C8A1576() : 0;
}

AP4_Result   
OX825E22A3::OXEDB6D5AB(AP4_Ordinal  OX2D6BC6B2, 
                                            AP4_Ordinal& OX76F4F9B3,
                                            AP4_Ordinal& OX1A1C6C40)
{
    OX76F4F9B3       = 0;
    OX1A1C6C40 = 0;
    
    AP4_Ordinal OX7CD0C3F4;
    return OX8C8A1576(OX2D6BC6B2, 
                             OX76F4F9B3, 
                             OX1A1C6C40, 
                             OX7CD0C3F4);
}

AP4_Result 
OX825E22A3::OX8C8A1576(AP4_Ordinal  OX2D6BC6B2,
                                       AP4_Ordinal& OX76F4F9B3,
                                       AP4_Ordinal& OX1A1C6C40,
                                       AP4_Ordinal& OX7CD0C3F4)
{
    OX76F4F9B3              = 0;
    OX1A1C6C40        = 0;
    OX7CD0C3F4 = 0;

    if (OX62E6D9E8 == NULL) return AP4_ERROR_INVALID_STATE;
    
    AP4_Ordinal OX1D7D9C3F = 0;
    AP4_Result OXFFB1D0DD = OX62E6D9E8->OX8C8A1576(OX2D6BC6B2+1, 
                                                      OX1D7D9C3F, 
                                                      OX1A1C6C40, 
                                                      OX7CD0C3F4);
    if (AP4_FAILED(OXFFB1D0DD)) return OXFFB1D0DD;
    if (OX1D7D9C3F == 0) return AP4_ERROR_INTERNAL;

    OX76F4F9B3 = OX1D7D9C3F-1;
    
    return AP4_SUCCESS;
}

AP4_Result 
OX825E22A3::OXEDB6D5AB(AP4_Ordinal   OX76F4F9B3, 
                                    AP4_Position& OX4DB3D35F)
{
    if (OXDC2F1E2F) {
        AP4_UI32 OX4DB3D35F_32;
        AP4_Result OXFFB1D0DD = OXDC2F1E2F->OXEDB6D5AB(OX76F4F9B3+1, OX4DB3D35F_32);
        if (AP4_SUCCEEDED(OXFFB1D0DD)) {
            OX4DB3D35F = OX4DB3D35F_32;
        } else {
            OX4DB3D35F = 0;
        }
        return OXFFB1D0DD;
    } else if (OX7A0A352B) {
        return OX7A0A352B->OXEDB6D5AB(OX76F4F9B3+1, OX4DB3D35F);
    } else {
        OX4DB3D35F = 0;
        return AP4_FAILURE;
    }
}

AP4_Result 
OX825E22A3::OX8C8A1576(AP4_Ordinal  OX76F4F9B3, 
                                    AP4_Position OX4DB3D35F)
{
    if (OXDC2F1E2F) {
        if ((OX4DB3D35F >> 32) != 0) return AP4_ERROR_OUT_OF_RANGE;
        return OXDC2F1E2F->OX8C8A1576(OX76F4F9B3+1, (AP4_UI32)OX4DB3D35F);
    } else if (OX7A0A352B) {
        return OX7A0A352B->OX8C8A1576(OX76F4F9B3+1, OX4DB3D35F);
    } else {
        return AP4_FAILURE;
    }
}

AP4_Result 
OX825E22A3::OX8C8A1576(AP4_Ordinal OX2D6BC6B2, AP4_Size OXCF0F1D2B)
{
    if (OX20A7A299) {
        return OX20A7A299->OX8C8A1576(OX2D6BC6B2+1, OXCF0F1D2B);
    } else if (OXDD2A1C1F) {
        return OXDD2A1C1F->OX8C8A1576(OX2D6BC6B2+1, OXCF0F1D2B);
    } else {    
        return AP4_FAILURE;
    }
}

AP4_Result 
OX825E22A3::OX8C8A1576(AP4_UI64     OX8A9D72F3, 
                                                AP4_Ordinal& OX2D6BC6B2)
{
    return OX4CFADF3C ? OX4CFADF3C->OX8C8A1576(OX8A9D72F3, OX2D6BC6B2) 
                      : AP4_FAILURE;
}

AP4_Ordinal  
OX825E22A3::OX8C8A1576(AP4_Ordinal OX2D6BC6B2, bool OX2A6C3F8D)
{
    if (OX0DDA3BA7 == NULL) return OX2D6BC6B2;
    
    OX2D6BC6B2 += 1;
    AP4_Cardinal OX4F6D8E3F = OX0DDA3BA7->OXEDB6D5AB().ItemCount();
    if (OX2A6C3F8D) {
        AP4_Ordinal OX1D7D9C3F = 0;    
        for (unsigned int OX9A9B4C5E=0; OX9A9B4C5E<OX4F6D8E3F; OX9A9B4C5E++) {
            if (OX0DDA3BA7->OXEDB6D5AB()[OX9A9B4C5E] >= OX2D6BC6B2) return OX1D7D9C3F;
            if (OX0DDA3BA7->OXEDB6D5AB()[OX9A9B4C5E]) OX1D7D9C3F = OX0DDA3BA7->OXEDB6D5AB()[OX9A9B4C5E]-1;
        }

        return OX1D7D9C3F;
    } else {
        for (unsigned int OX9A9B4C5E=0; OX9A9B4C5E<OX4F6D8E3F; OX9A9B4C5E++) {
            if (OX0DDA3BA7->OXEDB6D5AB()[OX9A9B4C5E] >= OX2D6BC6B2) {
                return OX0DDA3BA7->OXEDB6D5AB()[OX9A9B4C5E]?OX0DDA3BA7->OXEDB6D5AB()[OX9A9B4C5E]-1:OX2D6BC6B2-1;
            }
        }

        return OXEDB6D5AB();
    }
}